{
  "timestamp": "2025-11-21T21:08:54.953Z",
  "lessonId": "4b419bb3-d58b-4974-914c-c05dc7efdff0",
  "stage": "error",
  "errorType": "JSON parsing/validation error",
  "error": {
    "message": "Failed to upload lesson to storage: new row violates row-level security policy",
    "stack": "Error: Failed to upload lesson to storage: new row violates row-level security policy\n    at POST (/Users/sherifelmetwally/Desktop/parallel-arabic/src/routes/api/create-lesson/+server.ts:659:15)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async Module.render_endpoint (/Users/sherifelmetwally/Desktop/parallel-arabic/node_modules/@sveltejs/kit/src/runtime/server/endpoint.js:49:18)\n    at async resolve (/Users/sherifelmetwally/Desktop/parallel-arabic/node_modules/@sveltejs/kit/src/runtime/server/respond.js:462:17)\n    at async Module.respond (/Users/sherifelmetwally/Desktop/parallel-arabic/node_modules/@sveltejs/kit/src/runtime/server/respond.js:338:20)\n    at async file:///Users/sherifelmetwally/Desktop/parallel-arabic/node_modules/@sveltejs/kit/src/exports/vite/dev/index.js:524:22",
    "name": "Error"
  },
  "fullError": "{\"stack\":\"Error: Failed to upload lesson to storage: new row violates row-level security policy\\n    at POST (/Users/sherifelmetwally/Desktop/parallel-arabic/src/routes/api/create-lesson/+server.ts:659:15)\\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at async Module.render_endpoint (/Users/sherifelmetwally/Desktop/parallel-arabic/node_modules/@sveltejs/kit/src/runtime/server/endpoint.js:49:18)\\n    at async resolve (/Users/sherifelmetwally/Desktop/parallel-arabic/node_modules/@sveltejs/kit/src/runtime/server/respond.js:462:17)\\n    at async Module.respond (/Users/sherifelmetwally/Desktop/parallel-arabic/node_modules/@sveltejs/kit/src/runtime/server/respond.js:338:20)\\n    at async file:///Users/sherifelmetwally/Desktop/parallel-arabic/node_modules/@sveltejs/kit/src/exports/vite/dev/index.js:524:22\",\"message\":\"Failed to upload lesson to storage: new row violates row-level security policy\"}",
  "lessonContent": "```json\n{\n  \"id\": \"lesson-egy-001\",\n  \"title\": {\n    \"arabic\": \"الخطوة الأولى في المصري\",\n    \"english\": \"First Steps in Egyptian Arabic\",\n    \"transliteration\": \"Al-khatwa al-oola fil masry\"\n  },\n  \"level\": \"beginner\",\n  \"description\": {\n    \"english\": \"In this introductory lesson, you will learn the absolute essentials of Egyptian Arabic: how to say hello, introduce yourself, and ask someone how they are doing using the correct gender forms.\",\n    \"arabic\": \"في الدرس ده هنتعلم أساسيات العامية المصرية: إزاي تسلم، وتقدم نفسك، وتسأل عن الحال.\"\n  },\n  \"learningObjectives\": [\n    \"Greet people naturally in Egyptian Arabic\",\n    \"Introduce yourself using 'I am' and 'My name is'\",\n    \"Ask 'How are you?' to both males and females\",\n    \"Respond to 'How are you?' appropriately\"\n  ],\n  \"estimatedDuration\": 20,\n  \"prerequisites\": [],\n  \"subLessons\": [\n    {\n      \"id\": \"sub-01\",\n      \"title\": {\n        \"arabic\": \"التحية والأسماء\",\n        \"english\": \"Greetings and Names\",\n        \"transliteration\": \"El-taheya wal-asmaa\"\n      },\n      \"content\": {\n        \"title\": {\n          \"arabic\": \"كلمات الترحيب والتعارف\",\n          \"english\": \"Welcome and Introduction Words\",\n          \"transliteration\": \"Kalimat el-tarheeb wal-taarof\"\n        },\n        \"phrases\": [\n          {\n            \"arabic\": \"أهلاً\",\n            \"english\": \"Hello / Welcome\",\n            \"transliteration\": \"Ahlan\"\n          },\n          {\n            \"arabic\": \"أنا\",\n            \"english\": \"I\",\n            \"transliteration\": \"Ana\"\n          },\n          {\n            \"arabic\": \"اسمي\",\n            \"english\": \"My name\",\n            \"transliteration\": \"Esmy\"\n          },\n          {\n            \"arabic\": \"انتَ\",\n            \"english\": \"You (masculine)\",\n            \"transliteration\": \"Inta\"\n          },\n          {\n            \"arabic\": \"انتِ\",\n            \"english\": \"You (feminine)\",\n            \"transliteration\": \"Inti\"\n          },\n          {\n            \"arabic\": \"اسمك ايه؟\",\n            \"english\": \"What is your name? (to a male)\",\n            \"transliteration\": \"Esmak eh?\"\n          },\n          {\n            \"arabic\": \"اسمك ايه؟\",\n            \"english\": \"What is your name? (to a female)\",\n            \"transliteration\": \"Esmik eh?\"\n          }\n        ],\n        \"explanations\": [\n          {\n            \"english\": \"In Arabic, the word for 'You' changes depending on whether you are speaking to a male (Inta) or a female (Inti). 'Ana' (I) stays the same for everyone.\"\n          }\n        ]\n      },\n      \"exercises\": [\n        {\n          \"id\": \"ex-01\",\n          \"type\": \"matching\",\n          \"question\": {\n            \"english\": \"Match the Egyptian Arabic word to its English meaning.\",\n            \"arabic\": \"وصل الكلمة بمعناها\"\n          },\n          \"options\": [\n            {\n              \"arabic\": \"أنا\",\n              \"english\": \"I\",\n              \"transliteration\": \"Ana\",\n              \"isCorrect\": true\n            },\n            {\n              \"arabic\": \"انتَ\",\n              \"english\": \"You (male)\",\n              \"transliteration\": \"Inta\",\n              \"isCorrect\": true\n            },\n            {\n              \"arabic\": \"انتِ\",\n              \"english\": \"You (female)\",\n              \"transliteration\": \"Inti\",\n              \"isCorrect\": true\n            },\n            {\n              \"arabic\": \"أهلاً\",\n              \"english\": \"Hello\",\n              \"transliteration\": \"Ahlan\",\n              \"isCorrect\": true\n            }\n          ],\n          \"correctAnswer\": [\n            \"Ana-I\",\n            \"Inta-You (male)\",\n            \"Inti-You (female)\",\n            \"Ahlan-Hello\"\n          ],\n          \"hint\": {\n            \"english\": \"Remember that 'Inta' ends with an 'a' sound for males, and 'Inti' ends with an 'i' sound for females.\",\n            \"arabic\": \"افتكر إن 'انتَ' للمذكر و 'انتِ' للمؤنث\",\n            \"transliteration\": \"Efteker en inta lel mozakar wa inti lel moannas\"\n          }\n        }\n      ]\n    },\n    {\n      \"id\": \"sub-02\",\n      \"title\": {\n        \"arabic\": \"عامل ايه؟\",\n        \"english\": \"How are you?\",\n        \"transliteration\": \"Amel eh?\"\n      },\n      \"content\": {\n        \"title\": {\n          \"arabic\": \"السؤال عن الحال\",\n          \"english\": \"Asking about condition\",\n          \"transliteration\": \"El-soaal an el-haal\"\n        },\n        \"phrases\": [\n          {\n            \"arabic\": \"ازيك؟\",\n            \"english\": \"How are you? (to a male)\",\n            \"transliteration\": \"Ezayak\"\n          },\n          {\n            \"arabic\": \"ازيك؟\",\n            \"english\": \"How are you? (to a female)\",\n            \"transliteration\": \"Ezayek\"\n          },\n          {\n            \"arabic\": \"كويس\",\n            \"english\": \"Good (masculine)\",\n            \"transliteration\": \"Kwayyes\"\n          },\n          {\n            \"arabic\": \"كويسة\",\n            \"english\": \"Good (feminine)\",\n            \"transliteration\": \"Kwayyesa\"\n          },\n          {\n            \"arabic\": \"الحمد لله\",\n            \"english\": \"Thank God (Standard response to 'How are you')\",\n            \"transliteration\": \"Al-hamdu lillah\"\n          },\n          {\n            \"arabic\": \"شكراً\",\n            \"english\": \"Thank you\",\n            \"transliteration\": \"Shukran\"\n          }\n        ],\n        \"explanations\": [\n          {\n            \"english\": \"Adjectives also have gender in Arabic. A man says he is 'Kwayyes', but a woman says she is 'Kwayyesa'.\"\n          }\n        ]\n      },\n      \"exercises\": [\n        {\n          \"id\": \"ex-02\",\n          \"type\": \"multiple-choice\",\n          \"question\": {\n            \"english\": \"How would a woman reply to 'Ezayek?' (How are you?)\",\n            \"arabic\": \"واحدة ست هترد تقول ايه على سؤال 'ازيك'؟\"\n          },\n          \"options\": [\n            {\n              \"arabic\": \"أنا كويس\",\n              \"english\": \"I am good (male form)\",\n              \"transliteration\": \"Ana kwayyes\",\n              \"isCorrect\": false\n            },\n            {\n              \"arabic\": \"أنا كويسة\",\n              \"english\": \"I am good (female form)\",\n              \"transliteration\": \"Ana kwayyesa\",\n              \"isCorrect\": true\n            },\n            {\n              \"arabic\": \"انتَ كويس\",\n              \"english\": \"You are good\",\n              \"transliteration\": \"Inta kwayyes\",\n              \"isCorrect\": false\n            }\n          ],\n          \"correctAnswer\": \"Ana kwayyesa\",\n          \"hint\": {\n            \"english\": \"Females usually add an 'a' sound to the end of adjectives.\",\n            \"arabic\": \"المؤنث عادة بيزود 'ة' في آخر الصفة\",\n            \"transliteration\": \"El-moannas adatan beyzawwed 'a' fee akher el-seffa\"\n          }\n        }\n      ]\n    }\n  ],\n  \"review\": {\n    \"words\": [\n      {\n        \"arabic\": \"أهلاً\",\n        \"english\": \"Hello\",\n        \"transliteration\": \"Ahlan\"\n      },\n      {\n        \"arabic\": \"أنا\",\n        \"english\": \"I\",\n        \"transliteration\": \"Ana\"\n      },\n      {\n        \"arabic\": \"انتَ\",\n        \"english\": \"You (male)\",\n        \"transliteration\": \"Inta\"\n      },\n      {\n        \"arabic\": \"انتِ\",\n        \"english\": \"You (female)\",\n        \"transliteration\": \"Inti\"\n      },\n      {\n        \"arabic\": \"اسمي\",\n        \"english\": \"My name\",\n        \"transliteration\": \"Esmy\"\n      },\n      {\n        \"arabic\": \"ازيك\",\n        \"english\": \"How are you (male)\",\n        \"transliteration\": \"Ezayak\"\n      },\n      {\n        \"arabic\": \"ازيك\",\n        \"english\": \"How are you (female)\",\n        \"transliteration\": \"Ezayek\"\n      },\n      {\n        \"arabic\": \"كويس\",\n        \"english\": \"Good (male)\",\n        \"transliteration\": \"Kwayyes\"\n      },\n      {\n        \"arabic\": \"كويسة\",\n        \"english\": \"Good (female)\",\n        \"transliteration\": \"Kwayyesa\"\n      },\n      {\n        \"arabic\": \"شكراً\",\n        \"english\": \"Thank you\",\n        \"transliteration\": \"Shukran\"\n      }\n    ],\n    \"sentences\": [\n      {\n        \"arabic\": \"أهلاً، أنا اسمي أحمد.\",\n        \"english\": \"Hello, my name is Ahmed.\",\n        \"transliteration\": \"Ahlan, ana esmy Ahmed.\"\n      },\n      {\n        \"arabic\": \"ازيك يا سارة؟\",\n        \"english\": \"How are you, Sara?\",\n        \"transliteration\": \"Ezayek ya Sara?\"\n      },\n      {\n        \"arabic\": \"أنا كويسة، شكراً.\",\n        \"english\": \"I am good (female), thank you.\",\n        \"transliteration\": \"Ana kwayyesa, shukran.\"\n      },\n      {\n        \"arabic\": \"انتَ كويس؟\",\n        \"english\": \"Are you (male) good?\",\n        \"transliteration\": \"Inta kwayyes?\"\n      },\n      {\n        \"arabic\": \"الحمد لله، أنا كويس.\",\n        \"english\": \"Thank God, I am good (male).\",\n        \"transliteration\": \"Al-hamdu lillah, ana kwayyes.\"\n      }\n    ]\n  },\n  \"summary\": {\n    \"english\": \"In this lesson, you learned the basics of Egyptian introductions. You can now greet someone, say your name, ask how someone is doing based on their gender, and reply to that question yourself.\",\n    \"arabic\": \"في الدرس ده اتعلمنا أساسيات التعارف بالمصري. دلوقتي تقدر تسلم، وتقول اسمك، وتسأل حد عن حاله حسب هو ولد ولا بنت، وترد على السؤال ده.\"\n  },\n  \"keyTakeaways\": [\n    \"Different words are used for 'you' depending on gender (Inta/Inti).\",\n    \"Adjectives change ending based on gender (Kwayyes/Kwayyesa).\",\n    \"'Ezayak' is for males, 'Ezayek' is for females.\",\n    \"'Al-hamdu lillah' is a very common cultural response to 'How are you'.\"\n  ],\n  \"grammarFocus\": [\n    {\n      \"title\": \"Gender in Pronouns and Adjectives\",\n      \"english\": \"Egyptian Arabic distinguishes between males and females when saying 'You' and when describing oneself.\",\n      \"arabic\": \"العربي المصري بيفرق بين المذكر والمؤنث في الضمائر والصفات\",\n      \"examples\": [\n        {\n          \"arabic\": \"انتَ كويس\",\n          \"english\": \"You (male) are good\",\n          \"transliteration\": \"Inta kwayyes\"\n        },\n        {\n          \"arabic\": \"انتِ كويسة\",\n          \"english\": \"You (female) are good\",\n          \"transliteration\": \"Inti kwayyesa\"\n        }\n      ]\n    }\n  ],\n  \"culturalNotes\": [\n    {\n      \"title\": \"The Phrase 'Al-hamdu lillah'\",\n      \"english\": \"When asked 'How are you?', Egyptians almost al"
}